# mesoscopic heat conduction
# heat flow from hot right region to cold left region
# compare the temperature profile at the end opf the simulation,
# contained in file dump.last, to analytic solution.
#
#
echo            both
dimension       2
units		si
atom_style	meso
boundary        f p p

# par.lmp is generated by infslab.mac
include         "par.lmp"

variable        Lx equal 1.0
variable        dx equal 0.02
variable        h equal 3*${dx}
variable        mass_l equal ${rho_l}*${dx}^2
variable        mass_r equal ${rho_r}*${dx}^2
variable        t_l equal 1.0
variable        t_r equal 2.0
variable        e_l equal ${cv_l}*${t_l}
variable        e_r equal ${cv_r}*${t_r}


lattice		sq ${dx} origin 0.5 0.5 0
region		box block 0 ${Lx} 0 0.3 0 ${dx} units box
create_box	2 box
create_atoms	1 box



region          left  block EDGE 0.5 EDGE EDGE EDGE EDGE units box
region          right block 0.5 EDGE EDGE EDGE EDGE EDGE units box

set             region left  mass ${mass_l}
set             region right  mass ${mass_r}
set             region left  type 1
set             region right type 2
set             region left  meso_cv ${cv_l}
set             region right meso_cv ${cv_r}
set             region left  meso_e ${e_l}
set             region right meso_e ${e_r}
set             region left meso_rho ${rho_l}
set             region right meso_rho ${rho_r}

pair_style      sph/heatconduction
pair_coeff      1 1   ${k_l}           ${h}
variable        klr equal 2*${k_l}*${k_r}/(${k_r}+${k_l})
pair_coeff      1 2   ${klr}           ${h}
pair_coeff      2 2   ${k_r}           ${h}

compute         it_atom all meso_t/atom
compute         rho_peratom all meso_rho/atom
compute         it all reduce sum c_it_atom

thermo		10
thermo_style    custom step temp c_it
variable        dt equal 0.25e-2
timestep        ${dt}
neighbor	0 bin
fix             integrate_fix all meso/stationary

dump		dump_fix all custom 10 dump.heat id type x y z c_it_atom c_rho_peratom
dump_modify     dump_fix first yes
variable        nrun equal round(${tau}/${dt})
run             ${nrun}
undump          dump_fix

dump		dump_fix all custom 10 dump.last id type x y z c_it_atom c_rho_peratom
dump_modify     dump_fix first yes
run             0