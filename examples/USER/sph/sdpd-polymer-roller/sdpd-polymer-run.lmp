echo               both
log                ${dname}/log.lammps
dimension          ${ndim}
units              si
atom_style         hybrid  bond meso
communicate        single vel yes
# create simulation box

#3D box
include            ${ndim}-vars.lmp
#read_data           poly3d.txt
read_restart      sdpd.restart.9000000


special_bonds   lj 1 1 1


group solvent      type 1
group polymer      type 2
set  group solvent meso_rho ${sdpd_rho_solvent}
set  group polymer meso_rho ${sdpd_rho_polymer}

pair_style         hybrid/overlay sdpd/rhosum 1 sdpd
pair_coeff         * * sdpd/rhosum   ${h}
pair_coeff         1 1    sdpd ${sdpd_rho_solvent} ${sdpd_c} ${sdpd_eta_s} ${h} ${sdpd_temp} ${sdpd_background}
pair_coeff         1 2    sdpd ${sdpd_rho_solvent} ${sdpd_c} ${sdpd_eta_p} ${h} ${sdpd_temp} ${sdpd_background}
pair_coeff         2 2    sdpd ${sdpd_rho_polymer} ${sdpd_c} ${sdpd_eta_p} ${h} ${sdpd_temp} ${sdpd_background}

compute            rho_peratom all meso_rho/atom
compute            e_peratom all meso_e/atom
compute            ke_peratom all ke/atom
compute            ke all ke
compute            sdpd_kin all temp
fix                integrate_fix_full all meso

# "profile" corrected temperature
compute         pTemp all temp/profile 1 1 0 y 10

# average velocity
compute vxav all reduce ave vx
variable  vx_cm atom vx-c_vxav
fix av_vx all ave/spatial 1 ${Nfreq} ${Nfreq} &
y center 0.01 v_vx_cm file ${dname}/vx.av ave running units reduced

include stress.lmp
dump               dump_id all custom ${Nfreq} ${dname}/dump*.dat &
    id type x y z &
    vx vy vz c_rho_peratom

dump               dump_stress all custom ${Nfreq} ${dname}/stress*.dat &
    x y z &
    c_bstress[1] c_bstress[2] c_bstress[4] &
    c_astress[1] c_astress[2] c_astress[4] &
    c_substress[1] c_substress[2] c_substress[4]
    
dump_modify        dump_id first yes
dump_modify        dump_id sort id
dump_modify        dump_id pad 8

dump_modify        dump_stress first yes
dump_modify        dump_stress sort id
dump_modify        dump_stress pad 8


thermo_style       custom step c_sdpd_kin c_pTemp
thermo_modify      norm no
thermo             1000
variable    velx  atom vx
variable    vely  atom vy 
variable    velxy  atom  sqrt(v_velx*v_velx+v_vely*v_vely) 
include            ${ndim}-image.lmp

variable           eps equal 0*${dx}
neighbor           ${eps} bin
variable           eps delete
neigh_modify       every 1
include            settimestep.lmp
timestep           ${dt}

restart 1000000    ${dname}/sdpd.restart

bond_style fene
bond_coeff 1 ${H} ${r0}  0 0

#bond_style harmonic
#bond_coeff 1 ${H} ${r0}

variable            var_x atom ${A_kol}*${solvent_mass}*sin(2*PI*x/${Lx})*cos(2*PI*y/${Ly})
variable            var_y atom -${A_kol}*${solvent_mass}*cos(2*PI*x/${Lx})*sin(2*PI*y/${Ly})
fix                 kol_force all addforce v_var_x v_var_y 0.0
#variable            var_kol atom ${A_kol}*${solvent_mass}*cos(2*PI*y/${Ly})
#fix                 kol_force all addforce v_var_kol 0.0 0.0


run   100000000 every 10000 "velocity all zero linear"


