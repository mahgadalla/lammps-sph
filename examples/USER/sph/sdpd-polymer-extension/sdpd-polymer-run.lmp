echo               both
log                ${dname}/log.lammps
dimension          ${ndim}
units              si
atom_style         hybrid  bond meso
include            ${ndim}-vars.lmp
variable           cc equal 6*${dx}
communicate        single cutoff ${cc} vel yes
# create simulation box

#3D box
read_data           poly3d.txt
#read_restart         sdpd.restart.1000000
special_bonds   lj 1 1 1


group solvent      type 1
group polymer      type 2
set  group solvent meso_rho ${sdpd_rho_solvent}
set  group polymer meso_rho ${sdpd_rho_polymer}
group head id == ${N_start}
group tail id == ${N_end}
group  exten union head tail

pair_style         hybrid/overlay sdpd/rhosum 1 sdpd
pair_coeff         * * sdpd/rhosum   ${h}
fix                integrate_fix_full all meso
include            ${ndim}-image.lmp

#### begin prerun ####
restart     ${Nprerun}  ${dname}/sdpd.restart.tem
include           in.prerun
restart     0
#### end of prerun ####


variable           local_c equal ${sdpd_c}
variable           local_eta_s equal ${sdpd_eta_s}
variable           local_eta_p equal ${sdpd_eta_p}
variable           local_temp  equal ${sdpd_temp}
variable           local_H     equal ${H0}
variable           local_r0     equal ${r0}
include            in.pair_and_bond

compute            rho_peratom all meso_rho/atom
compute            e_peratom all meso_e/atom
compute            ke_peratom all ke/atom
compute            ke all ke
compute            sdpd_kin all temp

variable dxpos equal (x[${N_end}]-x[${N_start}])*(x[${N_end}]-x[${N_start}])
variable dypos equal (y[${N_end}]-y[${N_start}])*(y[${N_end}]-y[${N_start}]) 
variable dpos equal sqrt(v_dxpos+v_dypos)
#variable df equal fx[${N_end}]-fx[N_start]
variable  vtime equal  step
#compute endtoend exten pair/local dist
#variable disttwo euqual c_endtoend
fix extra exten  print 1000 "${vtime} ${dpos}" file ${dname}/extension.dat screen no

# "profile" corrected temperature
compute         pTemp all temp/profile 1 1 0 y 10

include stress.lmp

thermo_style       custom step c_sdpd_kin c_pTemp
thermo_modify      norm no
thermo             1000
#variable    velx  atom vx
#variable    vely  atom vy 
#variable    velxy  atom  sqrt(v_velx*v_velx+v_vely*v_vely) 

variable           eps equal 0.25*${dx}
neighbor           ${eps} bin
variable           eps delete
neigh_modify       every 1
include            settimestep.lmp
timestep           ${dt}

restart 1000000    ${dname}/sdpd.restart

fix force_head head addforce ${N_A_kol}*${solvent_mass} 0.0 0.0
fix force_tail tail addforce ${A_kol}*${solvent_mass} 0.0 0.0

run 1000000

unfix force_head
unfix force_tail

run 100000000


