echo               both
variable           ndim equal 2
dimension          ${ndim}
units              si
atom_modify map array sort 0 0
atom_style         meso
boundary          p p p
communicate        single vel yes
# create simulation box
#2D box
# domain size

# smothing length
variable          h equal 1.0
variable          dx equal ${h}/3.0
variable          Lx equal 100*${dx}
variable          Ly equal 100*${dx}
if "${ndim}==3" then &
"variable          Lz equal 4*${dx}" &
else &
"variable          Lz equal ${dx}/10"

variable           rho0 equal 1.0
if "${ndim}==3" then &
"lattice            sc ${dx} origin 0.5 0.5 0.5" &
else &
"lattice            sq ${dx} origin 0.5 0.5 0"

region             box block 0 ${Lx} 0 ${Ly} 0 ${Lz} units box
create_box         1 box
create_atoms       1 region box
variable           sdpd_mass  equal ${rho0}*${dx}^${ndim}
mass               1 ${sdpd_mass}

pair_style         hybrid/overlay sdpd/rhosum 1 sdpd
variable              c equal 0.1
variable           eta  equal 1.0
variable           temp equal 0.0
variable           gamma equal 1.0
variable           rho_background equal 0.0
pair_coeff         * * sdpd     ${rho0} ${c} ${eta} ${h} ${temp} ${gamma} ${rho_background}
pair_coeff         * * sdpd/rhosum   ${h}

# do full time integration
fix                integrate_fix_full all  meso

neighbor           0 bin
neigh_modify       every 1
timestep           1e-19

variable           force_sdpd_fx equal fx[1]
variable           force_sdpd_fy equal fy[1]
compute            rho_peratom all meso_rho/atom

velocity          all set 1 0 0

variable           pi            equal 3.1415927
variable           vv            atom   sin(2*${pi}*y/${Lx})
compute            diff_peratom all meso_diff/atom ${h} v_vv
variable           dvx           atom c_diff_peratom[2]
dump               dump_id all custom 1 dump*.dat id type x y z vx vy vz c_rho_peratom v_dvx
variable           dvv           equal v_dvx[1]
run                0
print              "f: ${force_sdpd_fx} ${force_sdpd_fy}"
print              "dA: ${dvv}"

