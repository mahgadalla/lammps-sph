echo               both
variable           ndim equal 2
dimension          ${ndim}
units              si
atom_modify map array sort 0 0
atom_style         meso
boundary          p p p
communicate        single vel yes
# create simulation box
#2D box
# domain size

# smothing length
variable          nx index 15
variable          Lx equal 1.0
variable          Ly equal ${Lx}
variable          dx equal ${Lx}/${nx}
variable           h equal 3*${dx}
variable          Natom equal ${nx}*${nx}
if "${ndim}==3" then &
"variable          Lz equal 4*${dx}" &
else &
"variable          Lz equal ${dx}/10"

variable           rho0 equal 1.0
if "${ndim}==3" then &
"lattice            sc ${dx} origin 0.5 0.5 0.5" &
else &
"lattice            sq ${dx} origin 0.5 0.5 0"

region             box block 0 ${Lx} 0 ${Ly} 0 ${Lz} units box
create_box         1 box
create_atoms       1 region box
variable           sdpd_mass  equal ${rho0}*${dx}^${ndim}
mass               1 ${sdpd_mass}

pair_style         hybrid/overlay sdpd/rhosum 1 sdpd
variable              c equal 0.1
variable           eta  equal 1.0
variable           temp equal 0.0
variable           gamma equal 1.0
variable           rho_background equal 0.0
pair_coeff         * * sdpd     ${rho0} ${c} ${eta} ${h} ${temp} ${gamma} ${rho_background}
pair_coeff         * * sdpd/rhosum   ${h}

# do full time integration
fix                integrate_fix_full all  meso

neighbor           0 bin
neigh_modify       every 1
timestep           0

compute            rho_peratom all meso_rho/atom

variable           lambda       equal 1.0
variable           maxD         equal 2*PI*${Lx}/${lambda}
variable           A            atom   sin(2*PI*x/${Lx}/${lambda})
variable           dA           atom   2*PI/${Lx}/${lambda}*cos(2*PI*x/${Lx}/${lambda})

compute            sph_diff all meso_diff/atom ${h} v_A
variable           dAsphx           atom c_sph_diff[1]

variable           dA_err       atom abs(v_dA-v_dAsphx)/${maxD}
compute            cave         all reduce ave v_dA_err

dump               dump_id all custom 1 dump*.dat id type x y z vx vy vz c_rho_peratom v_dAsphx v_dA

thermo_style       custom step  c_cave
run                1
